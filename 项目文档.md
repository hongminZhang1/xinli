# 「心晴驿站」项目开发

## 🎯 项目概述

**项目名称**：心晴驿站 - 青少年心理健康AI陪伴平台  
**技术栈**：Next.js 14 + React + TypeScript + Tailwind CSS + Shadcn/ui + Motion + Zustand + Prisma + Vercel Storage  
**数据库**：Vercel PostgreSQL (通过Vercel Storage)  
**部署平台**：Vercel  
**登录方式**：仅用户名密码登录  
**设备支持**：PC端优先，响应式设计

## 📋 完整功能需求

### 1. 用户认证系统（仅用户名密码）

```typescript
// 功能需求
interface AuthSystem {
  用户名注册: { 唯一性校验: string; 格式验证: string }
  密码安全: { 加密存储: string; 强度要求: string }
  会话管理: { JWT令牌: string; 自动续期: string }
  用户资料: { 昵称: string; 头像: string; 个性化设置: string }
}
```

### 2. 核心功能模块

```typescript
interface CoreFeatures {
  情绪追踪: {
    心情打卡: string
    情绪日历: string
    趋势图表: string
    情绪日记: string
  }
  AI倾诉伙伴: {
    实时对话: string
    情绪分析: string
    危机检测: string
    对话历史: string
  }
  心灵疗愈: {
    冥想音频: string
    心理文章: string
    呼吸练习: string
    放松音乐: string
  }
  专业资源: {
    咨询师目录: string
    智能匹配: string
    在线预约: string
    进度跟踪: string
  }
}
```

## 🗄️ Vercel Storage 数据库配置

### Prisma Schema 配置

```prisma
// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

// 用户模型
model User {
  id        String   @id @default(cuid())
  username  String   @unique  // 唯一用户名
  password  String   // bcrypt加密
  email     String?  // 可选邮箱，用于找回密码
  name      String?  // 显示名称
  avatar    String?
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 关联关系
  emotions     EmotionRecord[]
  chatSessions ChatSession[]
  appointments Appointment[]
  journalEntries JournalEntry[]

  @@map("users")
}

// 情绪记录
model EmotionRecord {
  id        String   @id @default(cuid())
  userId    String
  emotion   EmotionType  // 使用枚举类型
  intensity Int          // 强度 1-10
  notes     String?      // 备注
  tags      String[]     // 情绪标签
  createdAt DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("emotion_records")
}

// AI聊天会话
model ChatSession {
  id        String   @id @default(cuid())
  userId    String
  title     String   // 会话标题（AI生成）
  messages  Json     // 消息数组
  summary   String?  // AI生成总结
  moodScore Int?     // 情绪评分 1-10
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("chat_sessions")
}

// 咨询预约
model Appointment {
  id          String   @id @default(cuid())
  userId      String
  counselorId String
  date        DateTime // 预约时间
  duration    Int      @default(60) // 分钟
  status      AppointmentStatus @default(PENDING)
  notes       String?
  createdAt   DateTime @default(now())
  
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  counselor Counselor @relation(fields: [counselorId], references: [id])

  @@map("appointments")
}

// 咨询师
model Counselor {
  id          String   @id @default(cuid())
  name        String
  email       String   @unique
  avatar      String?
  specialty   String[] // 专长领域
  description String?
  experience  Int      // 年限
  rating      Float?   // 评分
  isAvailable Boolean  @default(true)
  
  appointments Appointment[]

  @@map("counselors")
}

// 情绪日记
model JournalEntry {
  id        String   @id @default(cuid())
  userId    String
  title     String
  content   String
  mood      String?
  tags      String[]
  isPrivate Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("journal_entries")
}

// 枚举类型
enum UserRole {
  USER
  COUNSELOR
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum EmotionType {
  HAPPY
  SAD
  ANXIOUS
  ANGRY
  CALM
  EXCITED
  TIRED
  STRESSED
  PEACEFUL
  CONFUSED
}
```

### 环境变量配置

```bash
# .env.local
# Vercel Storage 数据库连接
POSTGRES_PRISMA_URL="postgresql://user:password@host:5432/database?pgbouncer=true&connect_timeout=15"
POSTGRES_URL_NON_POOLING="postgresql://user:password@host:5432/database"

# 认证相关
NEXTAUTH_SECRET="your-secret-key"
NEXTAUTH_URL="http://localhost:3000"

# AI服务
OPENAI_API_KEY="your-openai-key"

# 文件上传（头像等）
UPLOADTHING_SECRET="your-uploadthing-secret"
UPLOADTHING_APP_ID="your-uploadthing-app-id"
```

## 🛠️ 技术实现规范

### PC优先布局设计

```typescript
// 布局结构
interface Layout {
  侧边导航: {
    Logo和品牌: string
    主导航菜单: string
    用户快捷操作: string
  }
  顶部栏: {
    用户信息: string
    快速操作: string
    通知提醒: string
  }
  主内容区: {
    卡片式布局: string
    网格系统: string
    详情面板: string
  }
  响应式断点: {
    PC: '1024px以上'
    平板: '768px - 1024px'
    手机: '768px以下'
  }
}
```

### 项目结构（PC优化）

```text
src/
├── app/
│   ├── (auth)/
│   │   ├── login/page.tsx
│   │   └── register/page.tsx
│   ├── dashboard/
│   │   ├── page.tsx                    # 仪表盘概览
│   │   ├── emotions/
│   │   │   ├── page.tsx                # 情绪追踪
│   │   │   └── calendar/page.tsx       # 情绪日历
│   │   ├── chat/
│   │   │   └── page.tsx                # AI聊天
│   │   ├── journal/
│   │   │   └── page.tsx                # 情绪日记
│   │   ├── resources/
│   │   │   └── page.tsx                # 疗愈资源
│   │   └── appointments/
│   │       └── page.tsx                # 咨询预约
│   ├── api/
│   └── layout.tsx
├── components/
│   ├── ui/                            # Shadcn/ui组件
│   ├── layout/
│   │   ├── Sidebar.tsx
│   │   ├── Header.tsx
│   │   └── UserNav.tsx
│   ├── dashboard/
│   │   ├── StatsCards.tsx
│   │   ├── EmotionTracker.tsx
│   │   └── RecentActivity.tsx
│   ├── emotions/
│   │   ├── EmotionPicker.tsx
│   │   ├── EmotionCalendar.tsx
│   │   └── EmotionChart.tsx
│   ├── chat/
│   │   ├── ChatWindow.tsx
│   │   ├── MessageList.tsx
│   │   └── ChatInput.tsx
│   └── resources/
│       ├── ResourceGrid.tsx
│       ├── CounselorCard.tsx
│       └── AppointmentForm.tsx
├── lib/
│   ├── auth.ts
│   ├── db.ts
│   └── utils.ts
├── store/
├── types/
└── utils/
```

### Zustand 状态管理

```typescript
// store/useAuthStore.ts
interface AuthState {
  user: User | null
  isAuthenticated: boolean
  isLoading: boolean
  login: (username: string, password: string) => Promise<void>
  register: (username: string, password: string, email?: string) => Promise<void>
  logout: () => void
  updateProfile: (data: Partial<User>) => Promise<void>
}

// store/useEmotionStore.ts
interface EmotionState {
  currentEmotion: EmotionRecord | null
  emotionHistory: EmotionRecord[]
  trends: EmotionTrend[]
  selectedDate: Date
  addEmotion: (emotionData: Omit<EmotionRecord, 'id' | 'userId' | 'createdAt'>) => Promise<void>
  getEmotionsByDate: (date: Date) => Promise<EmotionRecord[]>
  getTrends: (period: 'week' | 'month' | 'year') => Promise<void>
}

// store/useChatStore.ts
interface ChatState {
  sessions: ChatSession[]
  activeSession: ChatSession | null
  isTyping: boolean
  createSession: () => Promise<string>
  sendMessage: (sessionId: string, message: string) => Promise<void>
  loadSessions: () => Promise<void>
  deleteSession: (sessionId: string) => Promise<void>
}
```

### 第一步：项目初始化

```text
1. 创建Next.js 14项目，配置TypeScript
2. 设置Vercel Storage PostgreSQL数据库
3. 配置Prisma数据模型和迁移
4. 安装核心依赖：
   - Tailwind CSS + Shadcn/ui
   - Framer Motion
   - Zustand
   - NextAuth.js (仅Credentials提供者)
5. 设置项目结构和基础布局
```

### 第二步：认证系统开发

```text
1. 实现用户名密码注册页面
   - 用户名唯一性验证
   - 密码强度要求
   - 实时表单验证

2. 实现登录页面
   - 记住登录状态
   - 错误提示处理
   - 加载状态

3. 实现用户会话管理
   - JWT令牌管理
   - 自动续期
   - 路由保护
```

### 第三步：核心功能开发（按优先级）

```text
高优先级：
1. 仪表盘概览
   - 情绪统计卡片
   - 最近活动
   - 快速操作入口

2. 情绪追踪系统
   - 情绪选择器（大按钮设计）
   - 情绪日历视图
   - 趋势分析图表

3. AI聊天界面
   - 对话窗口
   - 消息历史
   - 实时响应

中优先级：
4. 情绪日记功能
5. 心灵疗愈资源库
6. 咨询预约系统

低优先级：
7. 个人资料设置
8. 数据导出功能
9. 高级分析报告
```


请基于以下要求开发「心晴驿站」青少年心理健康平台：

技术规格：

- 框架：Next.js 14 (App Router) + TypeScript
- 样式：Tailwind CSS + Shadcn/ui组件库
- 动画：Framer Motion
- 状态管理：Zustand
- 数据库：Prisma + Vercel PostgreSQL Storage
- 认证：NextAuth.js（仅用户名密码方式）
- 设备：PC端优先设计

核心功能要求：

1. 用户认证系统
   - 仅支持用户名密码注册登录
   - 用户名唯一性校验
   - 密码强度要求（最少6位）
   - 会话管理和自动续期

2. PC优先布局设计
   - 左侧导航栏 + 顶部栏 + 主内容区
   - 充分利用宽屏空间的卡片布局
   - 响应式设计（但优先PC体验）

3. 情绪健康管理
   - 情绪打卡系统（9种基础情绪）
   - 情绪日历和趋势图表
   - 情绪日记记录功能

4. AI倾诉伙伴
   - 实时对话界面
   - 对话历史管理
   - 情绪分析和危机检测

5. 心灵疗愈资源
   - 冥想音频库
   - 心理知识文章
   - 放松练习指导

6. 专业支持
   - 咨询师目录
   - 在线预约系统
   - 预约状态跟踪

数据库模型：

- User（用户名、密码、个人信息）
- EmotionRecord（情绪记录）
- ChatSession（聊天会话）
- JournalEntry（日记条目）
- Counselor（咨询师）
- Appointment（预约）

设计指导：

- 治愈系色彩方案（蓝色主调，绿色/黄色辅助）
- 圆角设计和柔和阴影
- 清晰的视觉层次和充足的白空间
- 流畅的过渡动画和微交互

开发优先级：

1. 项目搭建和认证系统
2. 仪表盘和情绪追踪
3. AI聊天功能
4. 其他辅助功能

请确保：

- TypeScript类型安全
- 代码结构清晰可维护
- PC端用户体验优秀
- 性能优化良好
- 完整的错误处理

## 🚀 Vercel 部署配置

```json
// vercel.json
{
  "version": 2,
  "buildCommand": "prisma generate && prisma db push && next build",
  "installCommand": "npm install",
  "framework": "nextjs",
  "regions": ["hkg1"],
  "env": {
    "NEXTAUTH_URL": "https://your-domain.vercel.app"
  }
}
```

